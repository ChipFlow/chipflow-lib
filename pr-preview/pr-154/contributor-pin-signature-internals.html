<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="prev" title="Platform API Reference" href="platform-api.html">
        <link rel="prefetch" href="_static/chipflow-logo.svg" as="image">

    <!-- Generated with Sphinx 7.4.7 and Furo 2025.09.25 -->
        <title>Pin Signature Architecture (Contributor Guide) - ChipFlow Platform Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  --admonition-font-size: 0.9 rem;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 0.9 rem;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --admonition-font-size: 0.9 rem;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">ChipFlow Platform Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/chipflow-logo.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">ChipFlow Platform Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started with ChipFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">ChipFlow Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation-guide.html">Simulation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="chipflow-toml-guide.html">Intro to <code class="docutils literal notranslate"><span class="pre">chipflow.toml</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="chipflow-toml-guide.html#project-name">project_name</a></li>
<li class="toctree-l1"><a class="reference internal" href="chipflow-toml-guide.html#clock-domains">clock_domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="chipflow-toml-guide.html#process">process</a></li>
<li class="toctree-l1"><a class="reference internal" href="chipflow-toml-guide.html#package">package</a></li>
<li class="toctree-l1"><a class="reference internal" href="chipflow-commands.html">The <code class="docutils literal notranslate"><span class="pre">chipflow</span></code> command</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-pin-signatures.html">Using Pin Signatures and Software Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="platform-api.html">Platform API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributor Guide</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Pin Signature Architecture (Contributor Guide)</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/contributor-pin-signature-internals.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="pin-signature-architecture-contributor-guide">
<h1>Pin Signature Architecture (Contributor Guide)<a class="headerlink" href="#pin-signature-architecture-contributor-guide" title="Link to this heading">¶</a></h1>
<p>This guide explains the internal architecture of ChipFlow’s pin signature system, annotation infrastructure, and how platforms consume this metadata. This is intended for contributors who need to understand or extend the pin signature system.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>ChipFlow uses a sophisticated annotation system to attach metadata to Amaranth hardware designs. This metadata describes:</p>
<ol class="arabic simple">
<li><p><strong>I/O configuration</strong> (drive modes, trip points, clock domains)</p></li>
<li><p><strong>Simulation models</strong> (UIDs and parameters for testbench generation)</p></li>
<li><p><strong>Software drivers</strong> (C/H files and register structures)</p></li>
<li><p><strong>Data attachments</strong> (software binaries to load into flash)</p></li>
</ol>
<p>This metadata is preserved through the entire flow from Python design → RTLIL → platform backends (silicon, simulation, software).</p>
</section>
<section id="annotation-infrastructure">
<h2>Annotation Infrastructure<a class="headerlink" href="#annotation-infrastructure" title="Link to this heading">¶</a></h2>
<p>Core Module: <code class="docutils literal notranslate"><span class="pre">chipflow/platform/io/annotate.py</span></code></p>
<p>The annotation system uses Amaranth’s <code class="docutils literal notranslate"><span class="pre">meta.Annotation</span></code> framework combined with Pydantic for type-safe JSON schema generation.</p>
<section id="amaranth-annotate-decorator">
<h3>amaranth_annotate() Decorator<a class="headerlink" href="#amaranth-annotate-decorator" title="Link to this heading">¶</a></h3>
<p>The core function is <code class="docutils literal notranslate"><span class="pre">amaranth_annotate()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">amaranth_annotate</span><span class="p">(</span>
    <span class="n">modeltype</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">TypedDict</span><span class="p">],</span>      <span class="c1"># TypedDict defining the schema</span>
    <span class="n">schema_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>                  <span class="c1"># JSON schema $id (e.g., &quot;https://chipflow.com/schemas/io-model/v0&quot;)</span>
    <span class="n">member</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;__chipflow_annotation__&#39;</span><span class="p">,</span>  <span class="c1"># Attribute name storing the data</span>
    <span class="n">decorate_object</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>    <span class="c1"># If True, decorates instances; if False, decorates classes</span>
<span class="p">):</span>
</pre></div>
</div>
<p><strong>How it works:</strong></p>
<ol class="arabic simple">
<li><p>Takes a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> model and generates a JSON schema using Pydantic’s <code class="docutils literal notranslate"><span class="pre">TypeAdapter</span></code></p></li>
<li><p>Creates an Amaranth <code class="docutils literal notranslate"><span class="pre">meta.Annotation</span></code> subclass with that schema</p></li>
<li><p>Returns a decorator that applies the annotation to classes or objects</p></li>
<li><p>The decorated class/object stores data in <code class="docutils literal notranslate"><span class="pre">member</span></code> attribute (e.g., <code class="docutils literal notranslate"><span class="pre">self._model</span></code>)</p></li>
<li><p>When serializing to RTLIL, Amaranth calls <code class="docutils literal notranslate"><span class="pre">Annotation.as_json()</span></code> which extracts the data</p></li>
</ol>
<p><strong>Example Usage:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">NotRequired</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chipflow.platform.io.annotate</span><span class="w"> </span><span class="kn">import</span> <span class="n">amaranth_annotate</span>

<span class="c1"># Define schema as TypedDict</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyModel</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">count</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="c1"># Create decorator</span>
<span class="nd">@amaranth_annotate</span><span class="p">(</span><span class="n">MyModel</span><span class="p">,</span> <span class="s2">&quot;https://example.com/my-model/v1&quot;</span><span class="p">,</span> <span class="s2">&quot;_my_data&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MySignature</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Signature</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Store data in attribute that decorator will extract</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_my_data</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">({</span><span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="o">...</span><span class="p">))})</span>
</pre></div>
</div>
<p><strong>Key Points:</strong></p>
<ul class="simple">
<li><p>The decorator doesn’t modify <code class="docutils literal notranslate"><span class="pre">__init__</span></code> - you must populate the data attribute yourself</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">decorate_object=True</span></code> is used with <code class="docutils literal notranslate"><span class="pre">attach_data()</span></code> to annotate signature instances</p></li>
<li><p>Pydantic validates the data and provides JSON schema with proper types</p></li>
<li><p>The schema is embedded in RTLIL annotations for downstream tools</p></li>
</ul>
</section>
<section id="submodule-metadata-function">
<h3>submodule_metadata() Function<a class="headerlink" href="#submodule-metadata-function" title="Link to this heading">¶</a></h3>
<p>Platforms extract annotations from the design using <code class="docutils literal notranslate"><span class="pre">submodule_metadata()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">submodule_metadata</span><span class="p">(</span><span class="n">fragment</span><span class="p">:</span> <span class="n">Fragment</span><span class="p">,</span> <span class="n">top_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generator that walks the Fragment tree and yields:</span>
<span class="sd">        (component, submodule_name, metadata_dict)</span>

<span class="sd">    metadata_dict contains:</span>
<span class="sd">        &#39;annotations&#39;: dict mapping schema_id → annotation data</span>
<span class="sd">        &#39;path&#39;: list of component names from root</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p><strong>Usage in Platforms:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">chipflow.platform.io.annotate</span><span class="w"> </span><span class="kn">import</span> <span class="n">submodule_metadata</span>

<span class="n">frag</span> <span class="o">=</span> <span class="n">Fragment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">meta</span> <span class="ow">in</span> <span class="n">submodule_metadata</span><span class="p">(</span><span class="n">frag</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">):</span>
    <span class="n">annotations</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;annotations&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">DRIVER_MODEL_SCHEMA</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
        <span class="n">driver_model</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">DriverModel</span><span class="p">)</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span>
            <span class="n">annotations</span><span class="p">[</span><span class="n">DRIVER_MODEL_SCHEMA</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># Use driver_model data...</span>
</pre></div>
</div>
</section>
</section>
<section id="i-o-signature-base-classes">
<h2>I/O Signature Base Classes<a class="headerlink" href="#i-o-signature-base-classes" title="Link to this heading">¶</a></h2>
<p>Core Module: <code class="docutils literal notranslate"><span class="pre">chipflow/platform/io/iosignature.py</span></code></p>
<section id="iomodeloptions-typeddict">
<h3>IOModelOptions TypedDict<a class="headerlink" href="#iomodeloptions-typeddict" title="Link to this heading">¶</a></h3>
<p>Defines all options for configuring I/O pins:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">IOModelOptions</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">invert</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">bool</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>
    <span class="n">individual_oe</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
    <span class="n">power_domain</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">clock_domain</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">buffer_in</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
    <span class="n">buffer_out</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
    <span class="n">sky130_drive_mode</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="n">Sky130DriveMode</span><span class="p">]</span>
    <span class="n">trip_point</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="n">IOTripPoint</span><span class="p">]</span>
    <span class="n">init</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]</span>
    <span class="n">init_oe</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]</span>
</pre></div>
</div>
<p>All fields use <code class="docutils literal notranslate"><span class="pre">NotRequired</span></code> to make them optional with sensible defaults.</p>
</section>
<section id="iomodel-typeddict">
<h3>IOModel TypedDict<a class="headerlink" href="#iomodel-typeddict" title="Link to this heading">¶</a></h3>
<p>Extends <code class="docutils literal notranslate"><span class="pre">IOModelOptions</span></code> with direction and width information:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">IOModel</span><span class="p">(</span><span class="n">IOModelOptions</span><span class="p">):</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">IODirection</span>  <span class="c1"># &quot;input&quot;, &quot;output&quot;, or &quot;bidir&quot;</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This is the complete model that gets annotated on I/O signatures.</p>
</section>
<section id="iosignature-base-class">
<h3>IOSignature Base Class<a class="headerlink" href="#iosignature-base-class" title="Link to this heading">¶</a></h3>
<p>The base class for all I/O signatures, decorated with <code class="docutils literal notranslate"><span class="pre">&#64;amaranth_annotate</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@amaranth_annotate</span><span class="p">(</span><span class="n">IOModel</span><span class="p">,</span> <span class="n">IO_ANNOTATION_SCHEMA</span><span class="p">,</span> <span class="s1">&#39;_model&#39;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IOSignature</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Signature</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">IODirection</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">IOModelOptions</span><span class="p">]):</span>
        <span class="c1"># Build the model from parameters</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">IOModel</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Create appropriate signal structure based on direction</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="n">width</span><span class="p">)}</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;o&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">width</span><span class="p">),</span>
                <span class="s2">&quot;oe&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">individual_oe</span> <span class="k">else</span> <span class="n">Out</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;bidir&quot;</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="n">width</span><span class="p">),</span>
                <span class="s2">&quot;o&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">width</span><span class="p">),</span>
                <span class="s2">&quot;oe&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">individual_oe</span> <span class="k">else</span> <span class="n">Out</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="c1"># Store model for annotation extraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Direction-Specific Subclasses:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">InputIOSignature</span><span class="p">(</span><span class="n">IOSignature</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OutputIOSignature</span><span class="p">(</span><span class="n">IOSignature</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BidirIOSignature</span><span class="p">(</span><span class="n">IOSignature</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;bidir&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="concrete-pin-signatures">
<h2>Concrete Pin Signatures<a class="headerlink" href="#concrete-pin-signatures" title="Link to this heading">¶</a></h2>
<p>Core Module: <code class="docutils literal notranslate"><span class="pre">chipflow/platform/io/signatures.py</span></code></p>
<p>Concrete pin signatures (UART, GPIO, SPI, etc.) combine I/O signatures with simulation metadata.</p>
<p>These signatures are annotations of the <strong>type</strong> of the external interface (UART, GPIO, SPI), allowing ChipFlow to select and typecheck suitable simulation models that match that interface type. The annotations are independent of any particular IP implementation - they describe the interface protocol, not the internal logic of peripherals.</p>
<section id="simulatable-interface-decorator">
<h3>simulatable_interface() Decorator<a class="headerlink" href="#simulatable-interface-decorator" title="Link to this heading">¶</a></h3>
<p>This decorator adds simulation model metadata for interface type identification:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">simulatable_interface</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="s2">&quot;com.chipflow.chipflow&quot;</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">decorate</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
        <span class="c1"># Apply amaranth_annotate for SimInterface</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">amaranth_annotate</span><span class="p">(</span><span class="n">SimInterface</span><span class="p">,</span> <span class="n">SIM_ANNOTATION_SCHEMA</span><span class="p">)</span>
        <span class="n">klass</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>

        <span class="c1"># Wrap __init__ to populate __chipflow_annotation__</span>
        <span class="n">original_init</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="fm">__init__</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">new_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">original_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__chipflow_annotation__</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="n">klass</span><span class="o">.</span><span class="n">__chipflow_uid__</span><span class="p">,</span>
                <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__chipflow_parameters__</span><span class="p">(),</span>
            <span class="p">}</span>

        <span class="n">klass</span><span class="o">.</span><span class="fm">__init__</span> <span class="o">=</span> <span class="n">new_init</span>
        <span class="n">klass</span><span class="o">.</span><span class="n">__chipflow_uid__</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">klass</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="s1">&#39;__chipflow_parameters__&#39;</span><span class="p">):</span>
            <span class="n">klass</span><span class="o">.</span><span class="n">__chipflow_parameters__</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">klass</span>
    <span class="k">return</span> <span class="n">decorate</span>
</pre></div>
</div>
<p><strong>What it does:</strong></p>
<ol class="arabic simple">
<li><p>Applies <code class="docutils literal notranslate"><span class="pre">amaranth_annotate(SimInterface,</span> <span class="pre">...)</span></code> to the class</p></li>
<li><p>Assigns a unique identifier (UID) like <code class="docutils literal notranslate"><span class="pre">&quot;com.chipflow.chipflow.UARTSignature&quot;</span></code></p></li>
<li><p>Wraps <code class="docutils literal notranslate"><span class="pre">__init__</span></code> to populate <code class="docutils literal notranslate"><span class="pre">__chipflow_annotation__</span></code> with UID and parameters</p></li>
<li><p>Allows signatures to specify parameters via <code class="docutils literal notranslate"><span class="pre">__chipflow_parameters__()</span></code> method</p></li>
</ol>
</section>
<section id="example-uartsignature">
<h3>Example: UARTSignature<a class="headerlink" href="#example-uartsignature" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@simulatable_interface</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UARTSignature</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Signature</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">IOModelOptions</span><span class="p">]):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">({</span>
            <span class="s2">&quot;tx&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">OutputIOSignature</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)),</span>
            <span class="s2">&quot;rx&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">InputIOSignature</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)),</span>
        <span class="p">})</span>
</pre></div>
</div>
<p><strong>Annotations on this signature:</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SIM_ANNOTATION_SCHEMA</span></code>: <code class="docutils literal notranslate"><span class="pre">{&quot;uid&quot;:</span> <span class="pre">&quot;com.chipflow.chipflow.UARTSignature&quot;,</span> <span class="pre">&quot;parameters&quot;:</span> <span class="pre">[]}</span></code></p></li>
<li><p>Nested <code class="docutils literal notranslate"><span class="pre">IO_ANNOTATION_SCHEMA</span></code> on <code class="docutils literal notranslate"><span class="pre">tx</span></code> and <code class="docutils literal notranslate"><span class="pre">rx</span></code> sub-signatures</p></li>
</ol>
</section>
<section id="example-gpiosignature-with-parameters">
<h3>Example: GPIOSignature with Parameters<a class="headerlink" href="#example-gpiosignature-with-parameters" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@simulatable_interface</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GPIOSignature</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Signature</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">IOModelOptions</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pin_count</span> <span class="o">=</span> <span class="n">pin_count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;individual_oe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Force individual OE for GPIO</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">({</span>
            <span class="s2">&quot;gpio&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">BidirIOSignature</span><span class="p">(</span><span class="n">pin_count</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__chipflow_parameters__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Expose pin_count as a parameter for simulation models</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;pin_count&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pin_count</span><span class="p">)]</span>
</pre></div>
</div>
<p><strong>Annotations:</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SIM_ANNOTATION_SCHEMA</span></code>: <code class="docutils literal notranslate"><span class="pre">{&quot;uid&quot;:</span> <span class="pre">&quot;...&quot;,</span> <span class="pre">&quot;parameters&quot;:</span> <span class="pre">[[&quot;pin_count&quot;,</span> <span class="pre">8]]}</span></code></p></li>
<li><p>Nested <code class="docutils literal notranslate"><span class="pre">IO_ANNOTATION_SCHEMA</span></code> on <code class="docutils literal notranslate"><span class="pre">gpio</span></code> with <code class="docutils literal notranslate"><span class="pre">width=8,</span> <span class="pre">individual_oe=True</span></code></p></li>
</ol>
</section>
<section id="softwaredriversignature">
<h3>SoftwareDriverSignature<a class="headerlink" href="#softwaredriversignature" title="Link to this heading">¶</a></h3>
<p>This signature wrapper attaches driver files to peripherals:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SoftwareDriverSignature</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Signature</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">members</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">DriverModel</span><span class="p">]):</span>
        <span class="c1"># Extract base path from component&#39;s module file</span>
        <span class="n">definition_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;component&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__module__</span><span class="p">]</span><span class="o">.</span><span class="vm">__file__</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">definition_file</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;_base_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_path</span>

        <span class="c1"># Default to &#39;bus&#39; if not specified</span>
        <span class="k">if</span> <span class="s1">&#39;regs_bus&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;regs_bus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bus&#39;</span>

        <span class="c1"># Convert generators to lists</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;c_files&#39;</span><span class="p">,</span> <span class="s1">&#39;h_files&#39;</span><span class="p">,</span> <span class="s1">&#39;include_dirs&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="c1"># Store and annotate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__chipflow_driver_model__</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">amaranth_annotate</span><span class="p">(</span><span class="n">DriverModel</span><span class="p">,</span> <span class="n">DRIVER_MODEL_SCHEMA</span><span class="p">,</span>
                        <span class="s1">&#39;__chipflow_driver_model__&#39;</span><span class="p">,</span> <span class="n">decorate_object</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">members</span><span class="o">=</span><span class="n">members</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>DriverModel TypedDict:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DriverModel</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">component</span><span class="p">:</span> <span class="n">wiring</span><span class="o">.</span><span class="n">Component</span> <span class="o">|</span> <span class="nb">dict</span>  <span class="c1"># Component metadata</span>
    <span class="n">regs_struct</span><span class="p">:</span> <span class="nb">str</span>                   <span class="c1"># C struct name (e.g., &quot;uart_regs_t&quot;)</span>
    <span class="n">h_files</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]]</span>   <span class="c1"># Header files</span>
    <span class="n">c_files</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]]</span>   <span class="c1"># C source files</span>
    <span class="n">include_dirs</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]]</span>  <span class="c1"># Include directories</span>
    <span class="n">regs_bus</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>         <span class="c1"># Bus member name (default: &quot;bus&quot;)</span>
    <span class="n">_base_path</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span>      <span class="c1"># Auto-filled: peripheral&#39;s directory</span>
</pre></div>
</div>
<p><strong>Example Usage in a Peripheral:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">chipflow.platform</span><span class="w"> </span><span class="kn">import</span> <span class="n">UARTSignature</span><span class="p">,</span> <span class="n">SoftwareDriverSignature</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">amaranth_soc</span><span class="w"> </span><span class="kn">import</span> <span class="n">csr</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UARTPeripheral</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">addr_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">SoftwareDriverSignature</span><span class="p">(</span>
                <span class="n">members</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;bus&quot;</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="n">addr_width</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="n">data_width</span><span class="p">)),</span>
                    <span class="s2">&quot;pins&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">UARTSignature</span><span class="p">()),</span>
                <span class="p">},</span>
                <span class="n">component</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">regs_struct</span><span class="o">=</span><span class="s1">&#39;uart_regs_t&#39;</span><span class="p">,</span>
                <span class="n">c_files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;drivers/uart.c&#39;</span><span class="p">],</span>
                <span class="n">h_files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;drivers/uart.h&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="attach-data-function">
<h3>attach_data() Function<a class="headerlink" href="#attach-data-function" title="Link to this heading">¶</a></h3>
<p>Attaches data (like <code class="docutils literal notranslate"><span class="pre">SoftwareBuild</span></code>) to both external and internal flash interfaces:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">attach_data</span><span class="p">(</span><span class="n">external_interface</span><span class="p">:</span> <span class="n">wiring</span><span class="o">.</span><span class="n">PureInterface</span><span class="p">,</span>
               <span class="n">component</span><span class="p">:</span> <span class="n">wiring</span><span class="o">.</span><span class="n">Component</span><span class="p">,</span>
               <span class="n">data</span><span class="p">:</span> <span class="n">DataclassProtocol</span><span class="p">):</span>
    <span class="c1"># Create Data annotation with the dataclass</span>
    <span class="n">data_dict</span><span class="p">:</span> <span class="n">Data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span>

    <span class="c1"># Annotate both the component&#39;s signature and external interface</span>
    <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">signature</span><span class="p">,</span> <span class="n">external_interface</span><span class="o">.</span><span class="n">signature</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="s1">&#39;__chipflow_data__&#39;</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">)</span>
        <span class="n">amaranth_annotate</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">DATA_SCHEMA</span><span class="p">,</span> <span class="s1">&#39;__chipflow_data__&#39;</span><span class="p">,</span>
                        <span class="n">decorate_object</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">sig</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Why annotate both?</strong></p>
<ul class="simple">
<li><p>External interface is visible at top-level for simulation testbench</p></li>
<li><p>Internal component holds the implementation for software platform</p></li>
<li><p>Both need access to the binary data for their respective purposes</p></li>
</ul>
</section>
</section>
<section id="platform-consumption">
<h2>Platform Consumption<a class="headerlink" href="#platform-consumption" title="Link to this heading">¶</a></h2>
<section id="silicon-platform">
<h3>Silicon Platform<a class="headerlink" href="#silicon-platform" title="Link to this heading">¶</a></h3>
<p>Core Module: <code class="docutils literal notranslate"><span class="pre">chipflow/platform/silicon.py</span></code></p>
<p>The silicon platform creates actual I/O ports from pin signatures.</p>
<p><strong>SiliconPlatformPort Class:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SiliconPlatformPort</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">PortLike</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">Pin</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port_desc</span><span class="p">:</span> <span class="n">PortDesc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port_desc</span> <span class="o">=</span> <span class="n">port_desc</span>

        <span class="c1"># Extract IOModel from port_desc</span>
        <span class="n">iomodel</span> <span class="o">=</span> <span class="n">port_desc</span><span class="o">.</span><span class="n">iomodel</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="n">iomodel</span><span class="o">.</span><span class="n">direction</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">iomodel</span><span class="o">.</span><span class="n">width</span>
        <span class="n">invert</span> <span class="o">=</span> <span class="n">iomodel</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;invert&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">init</span> <span class="o">=</span> <span class="n">iomodel</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">init_oe</span> <span class="o">=</span> <span class="n">iomodel</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;init_oe&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">individual_oe</span> <span class="o">=</span> <span class="n">iomodel</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;individual_oe&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Create signals based on direction</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;bidir&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">__i&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;bidir&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">__o&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">individual_oe</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">oe</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init_oe</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">__oe&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">oe</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init_oe</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">__oe&quot;</span><span class="p">)</span>

        <span class="c1"># Store invert for wire_up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invert</span> <span class="o">=</span> <span class="n">invert</span>
</pre></div>
</div>
<p><strong>Port Creation from Pinlock:</strong></p>
<p>The platform reads the top-level signature and creates ports:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># chipflow/platform/silicon.py (in SiliconPlatform.create_ports)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">top</span><span class="o">.</span><span class="n">signature</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">member</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="n">port_desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_port_desc</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>  <span class="c1"># Extracts IOModel from annotations</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">Sky130Port</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">port_desc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ports</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">port</span>
</pre></div>
</div>
<p><strong>Sky130Port - Process-Specific Extension:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Sky130Port</span><span class="p">(</span><span class="n">SiliconPlatformPort</span><span class="p">):</span>
    <span class="n">_DriveMode_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Sky130DriveMode</span><span class="o">.</span><span class="n">STRONG_UP_WEAK_DOWN</span><span class="p">:</span> <span class="mb">0b011</span><span class="p">,</span>
        <span class="n">Sky130DriveMode</span><span class="o">.</span><span class="n">OPEN_DRAIN_STRONG_UP</span><span class="p">:</span> <span class="mb">0b101</span><span class="p">,</span>
        <span class="c1"># ...</span>
    <span class="p">}</span>

    <span class="n">_VTrip_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">IOTripPoint</span><span class="o">.</span><span class="n">CMOS</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">IOTripPoint</span><span class="o">.</span><span class="n">TTL</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="c1"># ...</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">port_desc</span><span class="p">:</span> <span class="n">PortDesc</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">port_desc</span><span class="p">)</span>

        <span class="c1"># Extract Sky130-specific options</span>
        <span class="n">iomodel</span> <span class="o">=</span> <span class="n">port_desc</span><span class="o">.</span><span class="n">iomodel</span>
        <span class="n">drive_mode</span> <span class="o">=</span> <span class="n">iomodel</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sky130_drive_mode&#39;</span><span class="p">,</span> <span class="n">Sky130DriveMode</span><span class="o">.</span><span class="n">STRONG_UP_WEAK_DOWN</span><span class="p">)</span>
        <span class="n">trip_point</span> <span class="o">=</span> <span class="n">iomodel</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;trip_point&#39;</span><span class="p">,</span> <span class="n">IOTripPoint</span><span class="o">.</span><span class="n">CMOS</span><span class="p">)</span>

        <span class="c1"># Create configuration signals for Sky130 I/O cell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dm</span> <span class="o">=</span> <span class="n">Const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_DriveMode_map</span><span class="p">[</span><span class="n">drive_mode</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ib_mode_sel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vtrip_sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_VTrip_map</span><span class="p">[</span><span class="n">trip_point</span><span class="p">]</span>
        <span class="c1"># ... more Sky130-specific configuration</span>
</pre></div>
</div>
</section>
<section id="software-platform">
<h3>Software Platform<a class="headerlink" href="#software-platform" title="Link to this heading">¶</a></h3>
<p>Core Module: <code class="docutils literal notranslate"><span class="pre">chipflow/platform/software.py</span></code></p>
<p>The software platform extracts driver models and builds software.</p>
<p><strong>SoftwarePlatform.build():</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SoftwarePlatform</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">top</span><span class="p">):</span>
        <span class="n">frag</span> <span class="o">=</span> <span class="n">Fragment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">driver_models</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">roms</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Extract annotations from all top-level members</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">top</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">meta</span> <span class="ow">in</span> <span class="n">submodule_metadata</span><span class="p">(</span><span class="n">frag</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="n">annotations</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;annotations&#39;</span><span class="p">]</span>

                <span class="c1"># Extract driver models</span>
                <span class="k">if</span> <span class="n">DRIVER_MODEL_SCHEMA</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
                    <span class="n">driver_models</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">DriverModel</span><span class="p">)</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span>
                        <span class="n">annotations</span><span class="p">[</span><span class="n">DRIVER_MODEL_SCHEMA</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="c1"># Extract software builds</span>
                <span class="k">if</span> <span class="n">DATA_SCHEMA</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[</span><span class="n">DATA_SCHEMA</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SoftwareBuild&quot;</span><span class="p">:</span>
                        <span class="n">roms</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">SoftwareBuild</span><span class="p">)</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span>
                            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                        <span class="p">)</span>

        <span class="c1"># Find wishbone decoder to get memory map</span>
        <span class="n">wb_decoder</span> <span class="o">=</span> <span class="c1"># ... find decoder</span>
        <span class="n">windows</span> <span class="o">=</span> <span class="n">get_windows</span><span class="p">(</span><span class="n">wb_decoder</span><span class="p">)</span>

        <span class="c1"># Create software generator</span>
        <span class="n">sw</span> <span class="o">=</span> <span class="n">SoftwareGenerator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

        <span class="c1"># Add each peripheral with its driver</span>
        <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">driver_model</span> <span class="ow">in</span> <span class="n">driver_models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="n">windows</span><span class="p">[</span><span class="n">component</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sw</span><span class="o">.</span><span class="n">add_periph</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">driver_model</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">sw</span><span class="p">}</span>
</pre></div>
</div>
<p><strong>SoftwareGenerator - Code Generation:</strong></p>
<p>Located in <code class="docutils literal notranslate"><span class="pre">chipflow/software/soft_gen.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">SoftwareGenerator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_periph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">DriverModel</span><span class="p">):</span>
        <span class="c1"># Resolve driver file paths relative to peripheral&#39;s directory</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;_base_path&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;c_files&#39;</span><span class="p">,</span> <span class="s1">&#39;h_files&#39;</span><span class="p">,</span> <span class="s1">&#39;include_dirs&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_drivers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># Store peripheral info for soc.h generation</span>
        <span class="n">component</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;component&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">regs_struct</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;regs_struct&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_periphs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Periph</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="n">regs_struct</span><span class="p">,</span> <span class="n">address</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Generate soc.h with peripheral #defines</span>
        <span class="c1"># Generate start.S with startup code</span>
        <span class="c1"># Generate sections.lds with memory layout</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p><strong>Generated soc.h Example:</strong></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef SOC_H</span>
<span class="cp">#define SOC_H</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;drivers/uart.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;drivers/gpio.h&quot;</span>

<span class="cp">#define UART_0 ((volatile uart_regs_t *const)0x02000000)</span>
<span class="cp">#define GPIO_0 ((volatile gpio_regs_t *const)0x01000000)</span>

<span class="cp">#define putc(x) uart_putc(UART_0, x)</span>
<span class="cp">#define puts(x) uart_puts(UART_0, x)</span>

<span class="cp">#endif</span>
</pre></div>
</div>
</section>
</section>
<section id="complete-flow-example">
<h2>Complete Flow Example<a class="headerlink" href="#complete-flow-example" title="Link to this heading">¶</a></h2>
<p>Let’s trace a complete example from signature definition to platform usage.</p>
<section id="step-1-define-a-peripheral-with-driver">
<h3>Step 1: Define a Peripheral with Driver<a class="headerlink" href="#step-1-define-a-peripheral-with-driver" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># chipflow_digital_ip/io/_uart.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chipflow.platform</span><span class="w"> </span><span class="kn">import</span> <span class="n">UARTSignature</span><span class="p">,</span> <span class="n">SoftwareDriverSignature</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UARTPeripheral</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">init_divisor</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">SoftwareDriverSignature</span><span class="p">(</span>
                <span class="n">members</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;bus&quot;</span><span class="p">:</span> <span class="n">In</span><span class="p">(</span><span class="n">csr</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">addr_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">data_width</span><span class="o">=</span><span class="mi">8</span><span class="p">)),</span>
                    <span class="s2">&quot;pins&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">UARTSignature</span><span class="p">()),</span>  <span class="c1"># &lt;-- External interface</span>
                <span class="p">},</span>
                <span class="n">component</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">regs_struct</span><span class="o">=</span><span class="s1">&#39;uart_regs_t&#39;</span><span class="p">,</span>
                <span class="n">c_files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;drivers/uart.c&#39;</span><span class="p">],</span>
                <span class="n">h_files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;drivers/uart.h&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># ... implementation</span>
</pre></div>
</div>
</section>
<section id="step-2-use-in-top-level-design">
<h3>Step 2: Use in Top-Level Design<a class="headerlink" href="#step-2-use-in-top-level-design" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># design/design.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MySoC</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">({</span>
            <span class="s2">&quot;uart&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">UARTSignature</span><span class="p">()),</span>  <span class="c1"># &lt;-- Top-level interface</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">elaborate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Module</span><span class="p">()</span>

        <span class="c1"># Instantiate peripheral</span>
        <span class="n">m</span><span class="o">.</span><span class="n">submodules</span><span class="o">.</span><span class="n">uart</span> <span class="o">=</span> <span class="n">uart</span> <span class="o">=</span> <span class="n">UARTPeripheral</span><span class="p">(</span><span class="n">init_divisor</span><span class="o">=</span><span class="mi">217</span><span class="p">)</span>

        <span class="c1"># Connect to top-level</span>
        <span class="n">connect</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">flipped</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uart</span><span class="p">),</span> <span class="n">uart</span><span class="o">.</span><span class="n">pins</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</section>
<section id="step-3-annotations-applied">
<h3>Step 3: Annotations Applied<a class="headerlink" href="#step-3-annotations-applied" title="Link to this heading">¶</a></h3>
<p><strong>On ``self.uart`` (top-level):</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SIM_ANNOTATION_SCHEMA</span></code>: <code class="docutils literal notranslate"><span class="pre">{&quot;uid&quot;:</span> <span class="pre">&quot;com.chipflow.chipflow.UARTSignature&quot;,</span> <span class="pre">&quot;parameters&quot;:</span> <span class="pre">[]}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IO_ANNOTATION_SCHEMA</span></code> on <code class="docutils literal notranslate"><span class="pre">tx</span></code>: <code class="docutils literal notranslate"><span class="pre">{&quot;direction&quot;:</span> <span class="pre">&quot;output&quot;,</span> <span class="pre">&quot;width&quot;:</span> <span class="pre">1,</span> <span class="pre">...}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IO_ANNOTATION_SCHEMA</span></code> on <code class="docutils literal notranslate"><span class="pre">rx</span></code>: <code class="docutils literal notranslate"><span class="pre">{&quot;direction&quot;:</span> <span class="pre">&quot;input&quot;,</span> <span class="pre">&quot;width&quot;:</span> <span class="pre">1,</span> <span class="pre">...}</span></code></p></li>
</ul>
<p><strong>On ``uart.signature`` (peripheral):</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">DRIVER_MODEL_SCHEMA</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;component&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UARTPeripheral&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/_uart.py&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;regs_struct&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uart_regs_t&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;c_files&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;drivers/uart.c&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;h_files&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;drivers/uart.h&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;regs_bus&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bus&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_base_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/chipflow_digital_ip/io&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Same simulation and I/O annotations on nested <code class="docutils literal notranslate"><span class="pre">pins</span></code> member</p></li>
</ul>
</section>
<section id="step-4-silicon-platform-consumption">
<h3>Step 4: Silicon Platform Consumption<a class="headerlink" href="#step-4-silicon-platform-consumption" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># During silicon elaboration</span>
<span class="n">silicon_platform</span> <span class="o">=</span> <span class="n">SiliconPlatform</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="c1"># Creates Sky130Port for &quot;uart&quot;</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">Sky130Port</span><span class="p">(</span><span class="s2">&quot;uart&quot;</span><span class="p">,</span> <span class="n">port_desc_from_annotations</span><span class="p">)</span>

<span class="c1"># port.tx.o, port.tx.oe created as signals</span>
<span class="c1"># port.rx.i created as signal</span>
<span class="c1"># Configuration based on IOModel (drive modes, trip points)</span>
</pre></div>
</div>
</section>
<section id="step-5-software-platform-consumption">
<h3>Step 5: Software Platform Consumption<a class="headerlink" href="#step-5-software-platform-consumption" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># During software build</span>
<span class="n">software_platform</span> <span class="o">=</span> <span class="n">SoftwarePlatform</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">generators</span> <span class="o">=</span> <span class="n">software_platform</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>

<span class="c1"># Extracts DriverModel from uart.signature annotations</span>
<span class="c1"># Adds peripheral to SoftwareGenerator:</span>
<span class="c1">#   name=&quot;uart&quot;, addr=0x02000000, driver_model={...}</span>

<span class="c1"># Generates soc.h:</span>
<span class="c1">#   #include &quot;drivers/uart.h&quot;</span>
<span class="c1">#   #define UART ((volatile uart_regs_t *const)0x02000000)</span>
</pre></div>
</div>
</section>
<section id="step-6-user-software-uses-generated-api">
<h3>Step 6: User Software Uses Generated API<a class="headerlink" href="#step-6-user-software-uses-generated-api" title="Link to this heading">¶</a></h3>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// user_code.c</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;soc.h&quot;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">uart_init</span><span class="p">(</span><span class="n">UART</span><span class="p">,</span><span class="w"> </span><span class="mi">217</span><span class="p">);</span><span class="w">  </span><span class="c1">// Uses generated UART pointer</span>
<span class="w">    </span><span class="n">uart_puts</span><span class="p">(</span><span class="n">UART</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello from ChipFlow!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="adding-new-pin-signatures">
<h2>Adding New Pin Signatures<a class="headerlink" href="#adding-new-pin-signatures" title="Link to this heading">¶</a></h2>
<p>To add a new pin signature type:</p>
<ol class="arabic">
<li><p><strong>Define the signature class:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@simulatable_interface</span><span class="p">()</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyNewSignature</span><span class="p">(</span><span class="n">wiring</span><span class="o">.</span><span class="n">Signature</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">IOModelOptions</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param1</span> <span class="o">=</span> <span class="n">param1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param2</span> <span class="o">=</span> <span class="n">param2</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">({</span>
            <span class="s2">&quot;signal1&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">OutputIOSignature</span><span class="p">(</span><span class="n">width1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)),</span>
            <span class="s2">&quot;signal2&quot;</span><span class="p">:</span> <span class="n">Out</span><span class="p">(</span><span class="n">InputIOSignature</span><span class="p">(</span><span class="n">width2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)),</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__chipflow_parameters__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;param1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;param2&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param2</span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><p><strong>Add to exports in</strong> <code class="docutils literal notranslate"><span class="pre">chipflow/platform/__init__.py</span></code></p></li>
<li><p><strong>Add to re-export in</strong> <code class="docutils literal notranslate"><span class="pre">chipflow/platforms/__init__.py</span></code> (for backward compatibility)</p></li>
<li><p><strong>Create simulation model</strong> (if needed) matching the UID</p></li>
<li><p><strong>Update documentation</strong> in <code class="docutils literal notranslate"><span class="pre">docs/using-pin-signatures.rst</span></code></p></li>
</ol>
</section>
<section id="adding-custom-platform-backends">
<h2>Adding Custom Platform Backends<a class="headerlink" href="#adding-custom-platform-backends" title="Link to this heading">¶</a></h2>
<p>To add a new platform that consumes annotations:</p>
<ol class="arabic">
<li><p><strong>Import annotation infrastructure:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">chipflow.platform.io.annotate</span><span class="w"> </span><span class="kn">import</span> <span class="n">submodule_metadata</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chipflow.platform.io.signatures</span><span class="w"> </span><span class="kn">import</span> <span class="n">DRIVER_MODEL_SCHEMA</span><span class="p">,</span> <span class="n">SIM_ANNOTATION_SCHEMA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeAdapter</span>
</pre></div>
</div>
</li>
<li><p><strong>Walk the design and extract annotations:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frag</span> <span class="o">=</span> <span class="n">Fragment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">meta</span> <span class="ow">in</span> <span class="n">submodule_metadata</span><span class="p">(</span><span class="n">frag</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">):</span>
    <span class="n">annotations</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;annotations&#39;</span><span class="p">]</span>

    <span class="c1"># Check for your schema</span>
    <span class="k">if</span> <span class="n">MY_SCHEMA_ID</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span>
        <span class="n">my_data</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="n">annotations</span><span class="p">[</span><span class="n">MY_SCHEMA_ID</span><span class="p">])</span>
        <span class="c1"># Process my_data...</span>
</pre></div>
</div>
</li>
<li><p><strong>Use the extracted data</strong> for your platform-specific operations</p></li>
</ol>
</section>
<section id="json-schema-integration">
<h2>JSON Schema Integration<a class="headerlink" href="#json-schema-integration" title="Link to this heading">¶</a></h2>
<p>All annotations generate JSON schemas that are:</p>
<ul class="simple">
<li><p>Embedded in RTLIL <code class="docutils literal notranslate"><span class="pre">(*</span> <span class="pre">chipflow.annotation.{schema_id}</span> <span class="pre">*)</span></code> attributes</p></li>
<li><p>Validated using JSON Schema Draft 2020-12</p></li>
<li><p>Accessible to external tools via RTLIL parsing</p></li>
</ul>
<p><strong>Schema URI Convention:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">chipflow.platform.io.iosignature</span><span class="w"> </span><span class="kn">import</span> <span class="n">_chipflow_schema_uri</span>

<span class="c1"># Generates: &quot;https://chipflow.com/schemas/my-thing/v0&quot;</span>
<span class="n">MY_SCHEMA</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_chipflow_schema_uri</span><span class="p">(</span><span class="s2">&quot;my-thing&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Pydantic Integration:</strong></p>
<p>Pydantic’s <code class="docutils literal notranslate"><span class="pre">TypeAdapter</span></code> provides:</p>
<ul class="simple">
<li><p>Automatic JSON schema generation from <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code></p></li>
<li><p>Runtime validation when deserializing</p></li>
<li><p>Type hints for IDE support</p></li>
<li><p>Serialization to JSON-compatible Python dicts</p></li>
</ul>
</section>
<section id="key-files">
<h2>Key Files<a class="headerlink" href="#key-files" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">chipflow/platform/io/annotate.py</span></code> - Core annotation infrastructure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chipflow/platform/io/iosignature.py</span></code> - I/O signature base classes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chipflow/platform/io/signatures.py</span></code> - Concrete signatures and decorators</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chipflow/platform/silicon.py</span></code> - Silicon platform consumption</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chipflow/platform/software.py</span></code> - Software platform consumption</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chipflow/software/soft_gen.py</span></code> - Code generation</p></li>
</ul>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="using-pin-signatures.html"><span class="doc">Using Pin Signatures and Software Drivers</span></a> - User-facing guide for using pin signatures</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="platform-api.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Platform API Reference</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; ChipFlow Limited, 2021-2025
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Pin Signature Architecture (Contributor Guide)</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#annotation-infrastructure">Annotation Infrastructure</a><ul>
<li><a class="reference internal" href="#amaranth-annotate-decorator">amaranth_annotate() Decorator</a></li>
<li><a class="reference internal" href="#submodule-metadata-function">submodule_metadata() Function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#i-o-signature-base-classes">I/O Signature Base Classes</a><ul>
<li><a class="reference internal" href="#iomodeloptions-typeddict">IOModelOptions TypedDict</a></li>
<li><a class="reference internal" href="#iomodel-typeddict">IOModel TypedDict</a></li>
<li><a class="reference internal" href="#iosignature-base-class">IOSignature Base Class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#concrete-pin-signatures">Concrete Pin Signatures</a><ul>
<li><a class="reference internal" href="#simulatable-interface-decorator">simulatable_interface() Decorator</a></li>
<li><a class="reference internal" href="#example-uartsignature">Example: UARTSignature</a></li>
<li><a class="reference internal" href="#example-gpiosignature-with-parameters">Example: GPIOSignature with Parameters</a></li>
<li><a class="reference internal" href="#softwaredriversignature">SoftwareDriverSignature</a></li>
<li><a class="reference internal" href="#attach-data-function">attach_data() Function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#platform-consumption">Platform Consumption</a><ul>
<li><a class="reference internal" href="#silicon-platform">Silicon Platform</a></li>
<li><a class="reference internal" href="#software-platform">Software Platform</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complete-flow-example">Complete Flow Example</a><ul>
<li><a class="reference internal" href="#step-1-define-a-peripheral-with-driver">Step 1: Define a Peripheral with Driver</a></li>
<li><a class="reference internal" href="#step-2-use-in-top-level-design">Step 2: Use in Top-Level Design</a></li>
<li><a class="reference internal" href="#step-3-annotations-applied">Step 3: Annotations Applied</a></li>
<li><a class="reference internal" href="#step-4-silicon-platform-consumption">Step 4: Silicon Platform Consumption</a></li>
<li><a class="reference internal" href="#step-5-software-platform-consumption">Step 5: Software Platform Consumption</a></li>
<li><a class="reference internal" href="#step-6-user-software-uses-generated-api">Step 6: User Software Uses Generated API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-new-pin-signatures">Adding New Pin Signatures</a></li>
<li><a class="reference internal" href="#adding-custom-platform-backends">Adding Custom Platform Backends</a></li>
<li><a class="reference internal" href="#json-schema-integration">JSON Schema Integration</a></li>
<li><a class="reference internal" href="#key-files">Key Files</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=1f169f65"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    </body>
</html>